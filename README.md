# Adaptive MultiFactor Authentication Project

This repository contains various scripts and tools for context and adaptive multi-factor authentication, data processing, and machine learning. The project is organized into several directories, each serving a specific purpose.

This project is mainly divided into three sections: training, analyzing, and **infrastructure**.

# Training

`Directories:`
- GAN
- GenerateData
- SVN

To use this, run generate.py to create a combination of different users and the number of entry from each user. Next, run gan.py to generate as many new data points as needed for the SVN. Use the split.py tool in the SVN directory to split and can increase/decrease the number of "attackers" for the data. Finally run svn.py to train and test the data. It will output to terminal the data points and will create a ROC curve.

# Analysis

`Directories:`
- ProtegeScripting

This section was focused on using the tool Protege to **analyze** the data in a visual way, and to determine any **patterns** using different reasoners. This also allowed to easily create different "attacker" that an attacker might try and to test how a reasoner might handle that new incoming data.


# Infrastructure:

`Directories:`
- AndroidDocker
- DataGen
- Docker
- Kubernetes
- LogDocker
- MultifactorApp

This section was used to grab real data off of virtual android phones. To do this a "multifactor app" was created that would authenticate using voice and facial **recognition**, where it would also send the data to the DataGen docker. However, before this the AndroidDocker is used to install and run an android virtual phone and randomly installs a different OS with a different type of virtual phone. 

When the DataGen receives this **information**, it fills in some data spots that a virtual phone was not, such as an IP address or location. This was then sent to the LogDocker which collected all of the data from DataGen. 

This entire **infrastructure** was set up and tore down using kubernetes which is found in the kubernetes directory.

`Note:` There are some tools in this repo that are very specific to my instance, so will need to be adjusted accordingly. I am the **sole contributor** so there are some poor coding practices throughout. 

## Additional Notes

- Ensure that the necessary model files are present in the `voice_auth_model_cnn/` directory.
- Configure MySQL connection details in `csvtomysql/convert.py` before running the conversion script.
- For more detailed information, refer to the README files in each directory.

## Directory Structure

```
.
├── AndroidDocker/
│   ├── Dockerfile
│   ├── multifactorapp.apk
│   ├── phone.sh
│   └── refer.py
├── csvtomysql/
│   ├── convert.py
│   └── data/
├── DataGen/
│   ├── Dockerfile
│   ├── endpoint.py
│   ├── main.py
│   ├── requirements.txt
│   └── similar.py
├── Docker/
│   ├── data/
│   ├── Dockerfile
│   ├── face.py
│   ├── feature_extraction.py
│   ├── GetData.py
│   ├── parameters.py
│   ├── preprocess.py
│   ├── README.md
│   ├── requirements.txt
│   ├── voice_auth_model_cnn/
│   ├── voice_auth.py
│   ├── voice.py
│   └── voiceface.py
├── Executable/
│   └── build/
├── GAN/
│   ├── gan.py
│   ├── output.csv
│   ├── sample_data.csv
│   └── 100data/
├── GenerateData/
│   ├── generate.py
│   ├── sample_data.csv
│   ├── range.txt
│   └── dataFunctions.txt
├── Kubernetes/
├── LogDocker/
├── MultiFactorApp/
├── ProtegeScripting/
├── SVN/
│   ├── split.py
│   ├── test_result_rf.csv
│   ├── roc_curve_rf.png
│   ├── test_result_knn.csv
│   ├── roc_curve_knn.png
│   ├── test_result_svm.csv
│   ├── roc_curve_svm.png
│   ├── svm.py
│   ├── roc_curve.png
│   ├── output/
│   ├── test_result.csv
│   ├── train.csv
│   ├── test.csv
│   ├── res/
│   ├── trainsplit.py
│   └── xor.py
├── README.md
└── vms.txt
```

## Directories and Files

### GAN
Contains scripts for Generative Adversarial Network (GAN) training and evaluation.

- **gan.py**: Main script for training and evaluating GAN models.
- **output.csv**: Output data from GAN training.
- **sample_data.csv**: Sample data used for GAN training.
- **100data/**: Directory containing additional data for GAN training.

### GenerateData
Contains scripts for generating synthetic data for testing and training.

- **generate.py**: Main script for generating synthetic data.
- **sample_data.csv**: Sample data generated by the script.
- **range.txt**: Range definitions for data generation.
- **dataFunctions.txt**: Functions used for data generation.

### SVN
Contains scripts for Support Vector Machine (SVM) training and evaluation.

- **split.py**: Script for splitting data into training and testing sets.
- **test_result_rf.csv**: Test results for Random Forest model.
- **roc_curve_rf.png**: ROC curve for Random Forest model.
- **test_result_knn.csv**: Test results for KNN model.
- **roc_curve_knn.png**: ROC curve for KNN model.
- **test_result_svm.csv**: Test results for SVM model.
- **roc_curve_svm.png**: ROC curve for SVM model.
- **svm.py**: Main script for SVM training and evaluation.
- **roc_curve.png**: General ROC curve for model evaluation.
- **output/**: Directory containing output files.
- **test_result.csv**: General test results.
- **train.csv**: Training data.
- **test.csv**: Testing data.
- **res/**: Directory containing results.
- **trainsplit.py**: Script for splitting training data.
- **xor.py**: Script for XOR operation.

### ProtegeScripting
Contains scripts for converting CSV into Protege ontology management.

- **swrl.py**: Script for applying rules to RDF data for context-based risk/suspicion scoring.

### Project Infrastructure
The following directories and files are part of the project's infrastructure:

- **AndroidDocker/**: Contains Docker-related files for building and running the Android multi-factor authentication app.
- **csvtomysql/**: Scripts for converting CSV data to MySQL database.
- **DataGen/**: Container for data generation and processing from the android container.
- **Docker/**: Contains Docker-related files and scripts for various data processing and machine learning tasks.
- **Executable/**: Contains build files for the windows executable version of the multifactor application.
- **Kubernetes/**: Contains Kubernetes configuration files to run the logging container, data generation container, authentication container, and the android container.
- **LogDocker/**: Contains Docker-related files for logging from the data generation container.
- **MultiFactorApp/**: Contains the multi-factor authentication application and mobile files.
- **vms.txt**: Contains information about virtual machines.

## Getting Started

### Prerequisites

- Docker
- Python 3.11
- MySQL

### Installation

1. Clone the repository:
   ```bash
   git clone https://github.com/WomackBaker/MultiFactor.git
   cd multifactor-authentication
   ```

### Usage

1. Run the container inside of kubernetes:
   ```bash
   kubectl apply -f ./android.yaml -f auth.yaml -f gen.yaml -f log.yaml
   ```

2. **Voice Authentication**:
   - Enroll a new user using an audio file:
     ```bash
     python voice_auth.py -t enroll -n "name of person" -f /path/to/audio/audio.wav
     ```
   - Authenticate a user:
     ```bash
     python voice_auth.py -t recognize -f /path/to/audio/audio.flac
     ```

3. **Face Recognition**:
   - Use the Flask API to verify images:
     ```bash
     curl -X POST -F "img1=@/path/to/image.jpg" http://localhost:5000/verify-image
     ```

4. **Combined Voice and Face Recognition**:
   - Use the Flask API to verify voice and face:
     ```bash
     curl -X POST -F "voice=@/path/to/voice.wav" -F "name=user_name" http://localhost:30080/verify-voice
     curl -X POST -F "img1=@/path/to/image.jpg" http://localhost:30080/verify-image
     ```

5. **Data Generation**:
   - Use the Flask API to generate similar data:
     ```bash
     curl -X POST -H "Content-Type: application/json" -d '{"user":"user1","latitude":0.0,"longitude":0.0,"ipString":"192.168.1.1","currentTime":"2023-01-01 12:00:00","availableMemory":1000000,"rssi":-50,"timezone":"UTC","Processors":4,"Battery":50,"Vendor":"Vendor1","Model":"Model1","systemPerformance":5,"cpu":"CPU1","accel":1,"gyro":1,"magnet":1,"screenWidth":1080,"screenLength":1920,"screenDensity":2.0,"hasTouchScreen":true,"hasCamera":true,"hasFrontCamera":true,"hasMicrophone":true,"hasTemperatureSensor":true}' http://localhost:30082/data
     ```

6. **CSV to MySQL Conversion**:
   - Update the MySQL connection details in `csvtomysql/convert.py` and run:
     ```bash
     python convert.py
     ```

7. **Ontology and Rule Engine**:
   - Use the ProtegeScripting to apply rules to RDF data:
     ```bash
     python swrl.py
     ```

8. **GAN Training**:
   - Run the GAN training script:
     ```bash
     python gan.py
     ```

9. **Generate Synthetic Data**:
   - Run the data generation script:
     ```bash
     python generate.py
     ```

10. **SVM Training**:
    - Run the SVM training script:
      ```bash
      python svm.py
      ```
